{"version":3,"file":"inner-svg.js","sources":["../src/utils.ts","../src/core/InnerSVG.ts","../src/core/attr-handler.ts","../src/index.ts","../src/core/observer.ts"],"sourcesContent":["import { InjectedElements } from \"core/InnerSVG\";\r\n\r\n/**\r\n * Find an injected elements index to resolve his class\r\n * @param element\r\n * @returns\r\n */\r\nfunction findInjectedElementIndex(element: Node | HTMLElement) {\r\n  return InjectedElements.findIndex((e) => e.element === element);\r\n}\r\n\r\nexport { findInjectedElementIndex };\r\n","import { findInjectedElementIndex } from \"utils\";\r\n\r\nconst InjectedElements: { element: HTMLElement; instance: InjectSVG }[] = [];\r\n\r\ntype LoadFn = (injection: InjectSVG) => any;\r\n\r\nclass InjectSVG {\r\n  public svg: SVGElement;\r\n  private firstLoadFn: LoadFn;\r\n  private eachLoadFn: LoadFn;\r\n\r\n  constructor(public element: HTMLElement, public path: string) {\r\n    InjectedElements.push({ element, instance: this });\r\n    this.path = this.initPath(path);\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * Called when the first svg is injected (not when the path change)\r\n   * @param fn\r\n   */\r\n  onFirstLoad(fn: LoadFn) {\r\n    this.firstLoadFn = fn;\r\n  }\r\n\r\n  /**\r\n   * Called every time a new svg is injected (like when the path change)\r\n   * @param fn\r\n   */\r\n  onEachLoad(fn: LoadFn) {\r\n    this.eachLoadFn = fn;\r\n  }\r\n\r\n  /**\r\n   * Inject the svg\r\n   */\r\n  private async init() {\r\n    let firstLoad = true;\r\n    if (this.svg) {\r\n      firstLoad = false;\r\n      this.svg.remove();\r\n    }\r\n    await this.loadSVG();\r\n    this.copySameAttributesFromOriginalElement();\r\n    this.element.style.display = \"none\";\r\n    this.element.parentNode.insertBefore(this.svg, this.element);\r\n\r\n    if (firstLoad && this.firstLoadFn) this.firstLoadFn(this);\r\n    if (this.eachLoadFn) this.eachLoadFn(this);\r\n  }\r\n\r\n  /**\r\n   * Laod the svg\r\n   */\r\n  private async loadSVG() {\r\n    const req = await fetch(this.path);\r\n    const svgText = await req.text();\r\n    this.svg = this.initSVG(svgText);\r\n  }\r\n\r\n  /**\r\n   * Create the svg element\r\n   * @param svgText\r\n   * @returns\r\n   */\r\n  private initSVG(svgText: string): SVGElement {\r\n    const temp = document.createElement(\"div\");\r\n    temp.innerHTML = svgText;\r\n    for (const child of temp.childNodes) {\r\n      if (child instanceof SVGElement) return child;\r\n    }\r\n    this.destruct();\r\n    throw new Error(this.path + \" is not a valid SVG\");\r\n  }\r\n\r\n  /**\r\n   * Set the same attributes to the svg from the element\r\n   */\r\n  copySameAttributesFromOriginalElement() {\r\n    for (const attr of this.element.attributes) {\r\n      if (attr.name === \"data-i-svg\" || attr.name === \"id\") continue;\r\n      if (attr.name === \"style\") {\r\n        this.svg.setAttribute(\r\n          attr.name,\r\n          attr.value.replace(/display\\:\\s*?none\\;?/gi, \"\")\r\n        );\r\n        continue;\r\n      }\r\n      this.svg.setAttribute(attr.name, attr.value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Init the path of the svg\r\n   * @param path\r\n   * @returns\r\n   */\r\n  private initPath(path: string) {\r\n    const splittedPath = document.location.pathname.split(\"/\");\r\n    if (splittedPath[splittedPath.length - 1]?.includes(\".\"))\r\n      splittedPath.pop();\r\n    const absolutePath = splittedPath.join(\"/\");\r\n    return path.startsWith(\"/\") ? path : absolutePath + \"/\" + path;\r\n  }\r\n\r\n  /**\r\n   * Update the svg path\r\n   * @param path\r\n   */\r\n  public updatePath(path: string) {\r\n    this.path = this.initPath(path);\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * Remove the svg\r\n   */\r\n  public destruct() {\r\n    const injectedIndex = findInjectedElementIndex(this.element);\r\n    this.element.removeAttribute(\"data-i-svg\");\r\n    this.element.style.display = \"\";\r\n    this.svg.remove();\r\n    InjectedElements.splice(injectedIndex, 1);\r\n  }\r\n}\r\n\r\nexport { InjectSVG, InjectedElements };\r\n","import { findInjectedElementIndex } from \"utils\";\r\nimport { InjectSVG } from \"./InnerSVG\";\r\n\r\n/**\r\n * Handle attribute data-i-svg\r\n * @param elements\r\n */\r\nfunction AttributesHandler(elements: HTMLElement[] | NodeListOf<HTMLElement>) {\r\n  for (const element of elements) {\r\n    const alreadySetup = findInjectedElementIndex(element) !== -1;\r\n    const dontNeedInjection = element.dataset?.iSvg === undefined;\r\n\r\n    if (alreadySetup || dontNeedInjection) continue;\r\n\r\n    new InjectSVG(element, element.dataset.iSvg);\r\n  }\r\n}\r\n\r\nexport default AttributesHandler;\r\n","import { InjectSVG } from \"core/InnerSVG\";\r\nimport AttributesHandler from \"core/attr-handler\";\r\nimport initObserver from \"core/observer\";\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function () {\r\n  AttributesHandler(document.querySelectorAll(\"[data-i-svg]\"));\r\n  initObserver();\r\n});\r\n\r\n/**\r\n * Inject a svg into the dom\r\n * @param element\r\n * @param path\r\n * @returns\r\n */\r\nfunction innerSVG(element: HTMLElement, path: string) {\r\n  return new InjectSVG(element, path);\r\n}\r\n\r\nexport default innerSVG;\r\n","import { findInjectedElementIndex } from \"utils\";\r\nimport { InjectedElements } from \"./InnerSVG\";\r\nimport AttributesHandler from \"./attr-handler\";\r\n\r\n/**\r\n * Init an observer to see any change of the data-i-svg attribute\r\n */\r\nfunction initObserver() {\r\n  const observerDOM = new MutationObserver(function (mutations) {\r\n    const addedNodes: HTMLElement[] = [];\r\n\r\n    for (const mutation of mutations ?? []) {\r\n      //attributes changed\r\n      if (mutation.type === \"attributes\") {\r\n        const element = mutation.target as HTMLElement;\r\n        const injectedIndex = findInjectedElementIndex(element);\r\n\r\n        const isNewInjection = injectedIndex === -1;\r\n\r\n        if (isNewInjection) {\r\n          addedNodes.push(element);\r\n        } else {\r\n          const path = element.dataset.iSvg;\r\n          const injection = InjectedElements[injectedIndex].instance;\r\n          if (mutation.attributeName.includes(\"data-i-svg\"))\r\n            injection.updatePath(path);\r\n          else injection.copySameAttributesFromOriginalElement();\r\n        }\r\n      }\r\n\r\n      //added nodes\r\n      for (const addedNode of mutation.addedNodes) {\r\n        addedNodes.push(addedNode as HTMLElement);\r\n      }\r\n\r\n      //removed nodes\r\n      for (const removedNode of mutation.removedNodes) {\r\n        const injectedIndex = findInjectedElementIndex(removedNode);\r\n        if (injectedIndex !== -1)\r\n          InjectedElements[injectedIndex].instance.destruct();\r\n      }\r\n    }\r\n\r\n    if (addedNodes.length > 0) AttributesHandler(addedNodes);\r\n  });\r\n\r\n  observerDOM.observe(document.body, {\r\n    childList: true,\r\n    subtree: true,\r\n    attributes: true,\r\n  });\r\n}\r\n\r\nexport default initObserver;\r\n"],"names":["findInjectedElementIndex","element","InjectedElements","findIndex","e","InjectSVG","constructor","path","this","push","instance","initPath","init","onFirstLoad","fn","firstLoadFn","onEachLoad","eachLoadFn","firstLoad","svg","remove","loadSVG","copySameAttributesFromOriginalElement","style","display","parentNode","insertBefore","req","fetch","svgText","text","initSVG","temp","document","createElement","innerHTML","child","childNodes","SVGElement","destruct","Error","attr","attributes","name","setAttribute","value","replace","splittedPath","location","pathname","split","_a","length","includes","pop","absolutePath","join","startsWith","updatePath","injectedIndex","removeAttribute","splice","AttributesHandler","elements","alreadySetup","dontNeedInjection","undefined","dataset","iSvg","addEventListener","querySelectorAll","MutationObserver","mutations","addedNodes","mutation","type","target","injection","attributeName","addedNode","removedNode","removedNodes","observe","body","childList","subtree"],"mappings":"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"}